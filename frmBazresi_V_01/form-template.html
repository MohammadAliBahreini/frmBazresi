<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุฑู ุจุงุฒุฑุณ ูุฏุฑุช ูุตุฑู ุจุฑู</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="<?php echo plugin_dir_url(__FILE__); ?>css/persian-datepicker.min.css">
  <link rel="stylesheet" href="<?php echo plugin_dir_url(__FILE__); ?>css/style.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo-container">
        <img src="<?php echo plugin_dir_url(__FILE__); ?>images/iran-grid-logo.png" alt="ุจุฑู ููุทููโุง" class="logo">
        <img src="<?php echo plugin_dir_url(__FILE__); ?>images/load-management-logo.png" alt="ูุฏุฑุช ุจุงุฑ" class="logo">
      </div>
      <h1>ูุฑู ุจุงุฒุฑุณ ูุฏุฑุช ูุตุฑู ุจุฑู</h1>
      <p>ุงุฏุงุฑู ุจุฑู โ ูุงุญุฏ ฺฉูุชุฑู ุจุงุฑ ู ูุฏุฑุช ูุตุฑู ุงูุฑฺ</p>
    </div>

    <form id="inspectionForm" method="post" enctype="multipart/form-data">
      <!-- Hidden inputs ุจุฑุง AJAX ู nonce -->
      <input type="hidden" name="action" value="my_inspection_form_save">
      <input type="hidden" name="inspection_nonce" value="<?php echo wp_create_nonce('my_inspection_form_nonce'); ?>">

      <div class="form-section">
        <h3 class="form-section-title">ุงุทูุงุนุงุช ูพุงู</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="inspector">ูุงู ุจุงุฒุฑุณ:</label>
            <select id="inspector" name="inspector" required>
              <option value="">-- ุงูุชุฎุงุจ ฺฉูุฏ --</option>
              <option value="ุญุฌุช ุดุฑู">ุญุฌุช ุดุฑู</option>
              <option value="ูุงุฏ ุณุงูุงุฑ">ูุงุฏ ุณุงูุงุฑ</option>
              <option value="ุญุณู ุณุงูุงุฑ ูพูุฑ">ุญุณู ุณุงูุงุฑ ูพูุฑ</option>
              <option value="ูุฑูุงุฒ ููุจุฑ">ูุฑูุงุฒ ููุจุฑ</option>
              <option value="ุนู ุงูุฑ">ุนู ุงูุฑ</option>
            </select>
          </div>

          <div class="form-group">
            <label for="tariff">ุชุนุฑูู:</label>
            <select id="tariff" name="tariff" required>
              <option value="">-- ุงูุชุฎุงุจ ฺฉูุฏ --</option>
              <option value="ฺฉุดุงูุฑุฒ">ฺฉุดุงูุฑุฒ</option>
              <option value="ุฎุงูฺฏ">ุฎุงูฺฏ</option>
              <option value="ุนููู">ุนููู</option>
              <option value="ุงุฏุงุฑ">ุงุฏุงุฑ</option>
              <option value="ุตูุนุช">ุตูุนุช</option>
              <option value="ุณุงุฑ ูุตุงุฑู">ุณุงุฑ ูุตุงุฑู</option>
            </select>
          </div>

          <div class="form-group">
            <label for="office">ุงููุฑ:</label>
            <select id="office" name="office" required>
              <option value="">-- ุงูุชุฎุงุจ ฺฉูุฏ --</option>
              <option value="ฺฉ ุจูุฏุฑุนุจุงุณ">ฺฉ ุจูุฏุฑุนุจุงุณ</option>
              <option value="ุฏู ุจูุฏุฑุนุจุงุณ">ุฏู ุจูุฏุฑุนุจุงุณ</option>
              <option value="ุณู ุจูุฏุฑุนุจุงุณ">ุณู ุจูุฏุฑุนุจุงุณ</option>
              <option value="ฺูุงุฑ ุจูุฏุฑุนุจุงุณ">ฺูุงุฑ ุจูุฏุฑุนุจุงุณ</option>
              <option value="ูุดู">ูุดู</option>
              <option value="ูุฑูุฒ">ูุฑูุฒ</option>
              <option value="ููุงุจ">ููุงุจ</option>
              <option value="ุณุฑฺฉ">ุณุฑฺฉ</option>
              <option value="ุฌุงุณฺฉ">ุฌุงุณฺฉ</option>
              <option value="ุจูุฏุฑุฎูุฑ">ุจูุฏุฑุฎูุฑ</option>
              <option value="ุจูุฏุฑ ููฺฏู">ุจูุฏุฑ ููฺฏู</option>
              <option value="ุฑูุฏุฑ">ุฑูุฏุฑ</option>
              <option value="ุฌูุงุญ">ุฌูุงุญ</option>
              <option value="ุดุจฺฉูู">ุดุจฺฉูู</option>
              <option value="ูพุงุฑุณุงู">ูพุงุฑุณุงู</option>
              <option value="ุฑุถูุงู">ุฑุถูุงู</option>
              <option value="ุญุงุฌ ุขุจุงุฏ">ุญุงุฌ ุขุจุงุฏ</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="billId">ุดูุงุณู ูุจุถ:</label>
            <input type="text" id="billId" name="billId" maxlength="13" required placeholder="ูุซุงู: 1234567890123">
          </div>

          <div class="form-group">
            <label for="meterSerial">ุณุฑุงู ฺฉูุชูุฑ:</label>
            <input type="text" id="meterSerial" name="meterSerial" maxlength="11" required placeholder="ูุซุงู: 12345678901">
          </div>

          <div class="form-group">
            <label for="centerName">ูุงู ูุฑฺฉุฒ:</label>
            <input type="text" id="centerName" name="centerName" required>
          </div>

          <div class="form-group">
            <label for="centerActivity">ูุนุงูุช ูุฑฺฉุฒ:</label>
            <input type="text" id="centerActivity" name="centerActivity" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="visitDate">ุชุงุฑุฎ ุจุงุฒุฏุฏ:</label>
            <input type="text" id="visitDate" name="visitDate" class="persian-datepicker" required placeholder="ฑดฐณ/ฐด/ฐต">
          </div>

          <div class="form-group">
            <label for="visitTime">ุณุงุนุช ุจุงุฒุฏุฏ:</label>
            <input type="text" id="visitTime" name="visitTime" required placeholder="14:30">
          </div>

          <div class="form-group">
            <label for="previousVisitDate">ุชุงุฑุฎ ุจุงุฒุฏุฏ ูุจู:</label>
            <input type="text" id="previousVisitDate" name="previousVisitDate"  class="persian-datepicker"  placeholder="ูุซุงู: ฑดฐฒ/ฑฐ/ฒฐ">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="energyManager">ูุงู ูุณุฆูู ูุฑฺฉุฒ/ูุฏุฑุช ุงูุฑฺ:</label>
            <input type="text" id="energyManager" name="energyManager" required>
          </div>
          <div class="form-group">
            <label for="energyManagerPhone">ุดูุงุฑู ุชูุงุณ ูุณุฆูู ูุฑฺฉุฒ:</label>
            <input type="tel" id="energyManagerPhone" name="energyManagerPhone"
                   placeholder="ูุซุงู: ฐนฑฒณดตถทธน ุง ฐทฑณฒฒฒดดดด"
                   pattern="^09\d{9}$|^0\d{10}$"
                   title="ุดูุงุฑู ุชูุงุณ ุจุงุฏ ุจุง 09 ุง 0 ุดุฑูุน ุดูุฏ" required>
          </div>
        </div>

        <div class="form-row location-row">
          <div class="form-group address-group">
            <label for="address">ุขุฏุฑุณ ฺฉุงูู:</label>
            <textarea id="address" name="address" rows="2" required></textarea>
          </div>
          <div class="form-group">
            <label for="latitude">ุนุฑุถ ุฌุบุฑุงูุง:</label>
            <input type="text" id="latitude" name="latitude" placeholder="ฐ.ฑฒณดตถ" readonly required>
          </div>
          <div class="form-group">
            <label for="longitude">ุทูู ุฌุบุฑุงูุง:</label>
            <input type="text" id="longitude" name="longitude" placeholder="ฐ.ฑฒณดตถ" readonly required>
          </div>
          <button type="button" class="btn" id="getLocation">ุฏุฑุงูุช ูููุนุช ูฺฉุงู</button>
        </div>
      </div>

      <!-- ูพุฑุณุดูุงูู -->
      <div class="form-section">
        <h3 class="form-section-title">ูพุฑุณุดูุงูู ุจุงุฒุฑุณ</h3>
        <div id="questionsContainer">
          <div class="question-row">
            <div class="question-text">1. ูุดุชุฑฺฉ ุฌูุช ุจุงุฒุฏุฏ ููฺฉุงุฑ ูโููุงุฏุ</div>
            <div class="question-options">
              <label><input type="radio" name="q1" value="ุจูู"> ุจูู</label>
              <label><input type="radio" name="q1" value="ุฎุฑ"> ุฎุฑ</label>
            </div>
          </div>
          <div class="question-row">
               <div class="question-text">2. ูุฑฺฉุฒ ุฏุงุฑุง ูุณุฆูู ุงูุฑฺ ุจุง ุญฺฉู ู ุจุงุดุฏุ</div>
                       <div class="question-options">
              <label><input type="radio" name="q2" value="ุจูู"> ุจูู</label>
              <label><input type="radio" name="q2" value="ุฎุฑ"> ุฎุฑ</label>
            </div>
          </div>
          <div class="question-row">
               <div class="question-text">3. ุฏุฒู ฺูุฑุงุชูุฑ ุฏุฑ ูุฏุงุฑ ูุฑุงุฑ ู ฺฏุฑุฏุ</div>
            <div class="question-options">
              <label><input type="radio" name="q3" value="ุจูู"> ุจูู</label>
              <label><input type="radio" name="q3" value="ุฎุฑ"> ุฎุฑ</label>
            </div>
          </div>
          <div class="question-row">
               <div class="question-text">4. ุฏุฑ ุตูุฑุช ูุฌูุฏ ุฏุฒู ฺูุฑุงุชูุฑุ ูุงูู ููฺฉุงุฑ ุงูุถุงุก ุดุฏู ุงุณุชุ</div>
                       <div class="question-options">
              <label><input type="radio" name="q4" value="ุจูู"> ุจูู</label>
              <label><input type="radio" name="q4" value="ุฎุฑ"> ุฎุฑ</label>
            </div>
          </div>





        </div>
        <button type="button" id="addQuestionBtn" class="btn add-question-btn">+ ุงูุฒูุฏู ุณูุงู ุฌุฏุฏ</button>
      </div>

      <!-- ูุณุชูุฏุงุช -->
      <div class="form-section">
        <h3 class="form-section-title">ุชูุถุญุงุช ู ูุณุชูุฏุงุช</h3>
        <div class="form-group">
          <label for="comments">ุชูุถุญุงุช ฺฉู ู ูพุดููุงุฏุงุช:</label>
          <textarea id="comments" name="comments" rows="4"></textarea>
        </div>
        <div class="form-group">
          <label for="photos">ุนฺฉุณโูุง ูุญู ุจุงุฒุฏุฏ (ุญุฏุงฺฉุซุฑ ต ุนฺฉุณ):</label>
          <input type="file" id="photos" name="photos[]" multiple accept="image/*">
        </div>
        <div class="form-group">
          <label for="videos">ูููโูุง ูุญู ุจุงุฒุฏุฏ:</label>
          <input type="file" id="videos" name="videos[]" multiple accept="video/*">
        </div>
      </div>

      <!-- ุงูุถุงูุง -->
      <div class="form-section">
        <h3 class="form-section-title">ุงูุถุงูุง</h3>
        <div class="signature-container">
          <div class="signature-box">
            <div class="signature-label">ุงูุถุง ุจุงุฒุฑุณ</div>
            <canvas id="inspectorSignature" class="signature-canvas"></canvas>
            <button type="button" class="clear-signature-btn" id="clearInspectorSignature">ูพุงฺฉ ฺฉุฑุฏู</button>
          </div>
          <div class="signature-box">
            <div class="signature-label">ุงูุถุง ูุณุฆูู ูุฑฺฉุฒ</div>
            <canvas id="centerManagerSignature" class="signature-canvas"></canvas>
            <button type="button" class="clear-signature-btn" id="clearCenterManagerSignature">ูพุงฺฉ ฺฉุฑุฏู</button>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-submit">ุซุจุช ูุฑู</button>
    </form>
  </div> <!-- ูพุงุงู container -->

  <!-- ูพูู ุฏุจุงฺฏ -->
  <div class="debug-panel" id="debugPanel" style="display: none;"></div>
  <button class="debug-toggle" id="debugToggle">๐</button>

  <!-- ุจุงุฑฺฏุฐุงุฑ ุงุณฺฉุฑูพุชโูุง -->
  <script src="<?php echo plugin_dir_url(__FILE__); ?>js/persian-date.min.js"></script>
  <script src="<?php echo plugin_dir_url(__FILE__); ?>js/persian-datepicker.min.js"></script>
  <script src="<?php echo plugin_dir_url(__FILE__); ?>js/signature_pad.umd.min.js"></script>

  <!-- ุฏุงุฏู AJAX ูุฑุฏูพุฑุณ ุจุฑุง ุขุฏุฑุณ ุฏู -->
  <script>
    const myInspectionFormAjax = {
      ajaxurl: "<?php echo admin_url('admin-ajax.php'); ?>"
    };
  </script>

  <!-- ุงุณฺฉุฑูพุช ุงุตู ูุฑู -->
  <script src="<?php echo plugin_dir_url(__FILE__); ?>js/script.js"></script>
</body>
</html>
